<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div style="display:none">
   請輸入問題：
   <input id="say" name="say" type="text" value="" size="80" onkeydown="keyin(event)"/> <!-- 按 enter 時呼叫 keyin() 回答 --> 
   <input type="submit" value="送出" onclick="say()"/> <!-- 當送出按鈕按下，就呼叫 say() 函數回答 --> 
  </div>
  <BR/>
  <div id="dialogBox" style="width:95%; height:80%; overflow:auto; border:ridge 1px #888888; ">
>> 您好，我的朋友! 有心事嗎 ?<BR/>  
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chatGPT@1.0.0/dist/chatGPT.min.js"></script>
  <script type="text/javascript">
  
    function random(n) { // 從 0 到 n-1 中選一個亂數
      return Math.floor(Math.random()*n);
    }
    
    function say() { // 當送出鍵按下時，會呼叫這個函數進行回答動作
      append(document.getElementById("say").value); // 先將使用者輸入的問句放到「對話區」顯示。
      answer(); // 然後回答使用者的問題。
    }
    
    function keyin(event) { // 當按下 enter 鍵時，會呼叫此函數進行回答
      var keyCode = event.which; // 取出按下的鍵
      if (keyCode == 13) say(); // 如果是換行字元 \n ，就進行回答動作。
    }
    
    function append(line) { // 將 line 放到「對話區」顯示。
      var dialogBox = document.getElementById("dialogBox"); // 取出對話框 
      dialogBox.innerHTML += line+"<BR/>\n"; // 加入 line 這行文字，並加入換行 <BR/>\n
      dialogBox.scrollTop = dialogBox.scrollHeight; // 捲動到最下方。
    }

    function answer() { // 回答問題
      setTimeout(function () { // 停頓 1 到 3 秒再回答問題 (因為若回答太快就不像人了，人打字需要時間)
        append(">> "+getAnswer());
      }, 1000+random(2000));
    }
    
    function getAnswer() {
      var say = document.getElementById("say").value; // 取得使用者輸入的問句。
	  document.getElementById("say").value = "";
      // 建立 chatGPT 物件
      var chatGPT = new ChatGPT("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");
      // 呼叫 chatGPT 的 generate() 方法進行回答
      var response = chatGPT.generate(say, {max_tokens: 1024});
      // 將回應文字加上換行符號
      return response+"\n";
    }   
  </script>
</body>
</html>
